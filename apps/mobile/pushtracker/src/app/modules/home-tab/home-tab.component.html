<PullToRefresh (loaded)="onHomeTabLoaded()" (unloaded)="onHomeTabUnloaded()" (refresh)="refreshPlots($event)" [color]="savedTheme === 'DEFAULT' ? '#753bbd' : '#00c1d5'">
  <ScrollView class="home-tab-layout" height="100%">
    <StackLayout row="1" col="0" verticalAlignment="center" *ngIf="!weeklyActivityLoaded">
      <ActivityIndicator height="10%" width="10%" verticalAlignment="center" horizontalAlignment="center" [color]="savedTheme === 'DEFAULT' ? '#753bbd' : '#00c1d5'" busy="true"></ActivityIndicator>
      <Label text="Loading your data..." textAlign="center" textWrap="true"></Label>
    </StackLayout>
    <StackLayout row="1" col="0" *ngIf="weeklyActivityLoaded">
      // Mock ActionBar
      <MockActionBar [showBackNav]="false" [showInfoBtn]="true"></MockActionBar>

      // Activity Circles
      <GridLayout rows="*, auto, *" columns="*, auto, *" height="240" width="100%">
        // Distance Circle (outer/purple)
        <AnimatedCircle id="distanceCircle" rowSpan="3" colSpan="3" [width]="screenWidth / 1.5" animated="true" animateFrom="0" clockwise="true" rimWidth="10" barWidth="28" [progress]="distanceCirclePercentage"> </AnimatedCircle>
        // Coast Time Circle (inner/teal)
        <AnimatedCircle id="coastTimeCircle" rowSpan="3" colSpan="3" [width]="screenWidth / 2" [height]="screenWidth / 2" animated="true" animateFrom="0" clockwise="true" rimWidth="10" barWidth="28" [progress]="coastTimeCirclePercentage">
        </AnimatedCircle>
        <GridLayout row="1" col="1" rows="auto, *, auto" columns="auto, *, auto" class="distance-remaining-circle" ripple rippleColorAlpha="0.18" (tap)="onActivityTap()">
          <Label class="today-message" row="1" col="1" [text]="todayMessage" textWrap="true"></Label>
        </GridLayout>
      </GridLayout>

      // Percentage Data Details
      <GridLayout class="percentage-data-layout" height="100" rows="*, *" columns="*, auto, auto, 20, auto, auto, *">
        // cousteau circle for coast-time values
        <StackLayout row="0" rowSpan="2" col="1" class="cousteau-circle">
          <Label text="&#xe5cc;"></Label>
        </StackLayout>

        <GridLayout row="0" rowSpan="2" col="2" rows="auto, auto" columns="*, auto, *">
          <Label row="0" col="0" class="value" [text]="todayCoastTime"></Label>
          <Label row="0" col="1" class="max-value" [text]="coastTimeCirclePercentageMaxValue"></Label>
          <Label row="1" col="0" colSpan="3" class="description" [text]="'general.coast-time' | translate"></Label>
        </GridLayout>

        // violet-circle for distance values
        <StackLayout row="0" rowSpan="2" col="4" class="violet-circle">
          <Label text="&#xe5cc;"></Label>
        </StackLayout>

        <GridLayout row="0" rowSpan="2" col="5" rows="auto, auto" columns="*, auto, *">
          <Label row="0" col="0" class="value" [text]="todayCoastDistance"></Label>
          <Label row="0" col="1" class="max-value" [text]="distanceCirclePercentageMaxValue"></Label>
          <Label row="1" col="0" colSpan="3" class="description" [text]="'general.distance' | translate"></Label>
        </GridLayout>
      </GridLayout>

      // Detailed Data
      <GridLayout rows="auto, auto" columns="*, *, *, *, *" class="detail-data">
        // push count data
        <Label row="0" col="0" class="detail-value" [text]="todayPushCount"></Label>
        <Label textWrap="true" row="1" col="0" class="detail-description" [text]="'general.pushes-today' | translate"></Label>
        // coast time data
        <Label row="0" col="2" class="detail-value" [text]="todayDriveDistance"></Label>
        <Label textWrap="true" row="1" col="2" class="detail-description" [text]="(user?.data.distance_unit_preference === 0 ? 'general.km-today' : 'general.miles-today') | translate"></Label>
        // distance data
        <Label row="0" col="4" class="detail-value" [text]="todayOdometer"></Label>
        <Label textWrap="true" row="1" col="4" class="detail-description" [text]="(user?.data.distance_unit_preference === 0 ? 'general.odometer-km' : 'general.odometer') | translate"></Label>
      </GridLayout>

      // Coast Time Chart
      <GridLayout rows="auto, *" class="chart-layout" (tap)="onCoastTimeChartSelected($event)">
        <FlexboxLayout width="80%" horizontalAlignment="center" flexWrap="wrap" alignContent="flex-start">
          <Label class="title" [text]="coastTimeGoalMessage"></Label>
          <Label class="goal-value" [text]="coastTimeGoalValue"></Label>
          <Label class="title" [text]="coastTimeGoalUnit"></Label>
        </FlexboxLayout>
        <RadCartesianChart row="1" id="homeTabWeeklyCoastTimeChart" pointSelectionMode="Single" (pointSelected)="onCoastTimeBarSelected($event)">
          <RadCartesianChartGrid tkCartesianGrid horizontalLinesVisible="true" verticalLinesVisible="false" horizontalStripLinesVisible="false" verticalStripLinesVisible="false"> </RadCartesianChartGrid>
          <CategoricalAxis
            tkCartesianHorizontalAxis
            [labelTextColor]="savedTheme == 'DARK' ? 'White' : 'Black'"
            lineHidden="true"
            tickHidden="false"
            majorTickInterval="1"
            labelSize="12"
            labelMargin="20"
            tickLength="1"
            labelFitMode="Multiline"
            plotMode="OnTicks"
          >
          </CategoricalAxis>

          <LinearAxis
            tkCartesianVerticalAxis
            id="vAxis"
            [labelTextColor]="savedTheme == 'DARK' ? 'White' : 'Black'"
            horizontalLocation="Right"
            labelMargin="10"
            lineHidden="true"
            [maximum]="yAxisMax"
            minumum="1"
            [majorStep]="yAxisStep"
            [labelFormat]="yAxisMax === 1.0 ? '%.1f' : '%.0f'"
          ></LinearAxis>

          <BarSeries tkCartesianSeries [items]="weeklyActivity" seriesName="WeeklyActivity" categoryProperty="xAxis" valueProperty="coastTime"> </BarSeries>

          <Palettes>
            <Palette tkCartesianPalette seriesName="WeeklyActivity">
              <PaletteEntry tkCartesianPaletteEntry [fillColor]="savedTheme === 'DEFAULT' ? '#753bbd' : '#00c1d5'" [strokeColor]="savedTheme === 'DEFAULT' ? '#753bbd' : '#00c1d5'"></PaletteEntry>
            </Palette>
            <Palette tkCartesianPalette seriesName="GoalLineSeries">
              <PaletteEntry tkCartesianPaletteEntry [fillColor]="savedTheme === 'DEFAULT' ? '#e31c79' : '#00c1d5'" [strokeColor]="savedTheme === 'DEFAULT' ? '#e31c79' : '#00c1d5'"></PaletteEntry>
            </Palette>
          </Palettes>

          <ChartGridLineAnnotation
            tkCartesianAnnotations
            axisId="vAxis"
            hidden="false"
            [value]="coastTimePlotAnnotationValue"
            zPosition="AboveSeries"
            strokeWidth="2"
            [strokeColor]="savedTheme === 'DEFAULT' ? '#e31c79' : '#00c1d5'"
            strokeDashPattern="3, 3"
          >
          </ChartGridLineAnnotation>
        </RadCartesianChart>
      </GridLayout>

      // Distance Time Chart
      <GridLayout rows="auto, *" class="chart-layout" (tap)="onDistanceChartSelected($event)">
        <FlexboxLayout width="80%" horizontalAlignment="center" flexWrap="wrap" alignContent="flex-start">
          <Label class="title" [text]="distanceGoalMessage"></Label>
          <Label class="goal-value" [text]="distanceGoalValue"></Label>
          <Label class="title" [text]="distanceGoalUnit"></Label>
        </FlexboxLayout>
        <RadCartesianChart row="1" id="homeTabWeeklyCoastDistanceChart" [palettes]="distancePlotPalettes" pointSelectionMode="Single" (pointSelected)="onDistanceBarSelected($event)">
          <RadCartesianChartGrid tkCartesianGrid horizontalLinesVisible="true" verticalLinesVisible="false" horizontalStripLinesVisible="false" verticalStripLinesVisible="false"> </RadCartesianChartGrid>

          <CategoricalAxis
            tkCartesianHorizontalAxis
            [labelTextColor]="savedTheme == 'DARK' ? 'White' : 'Black'"
            lineHidden="true"
            tickHidden="false"
            majorTickInterval="1"
            labelSize="12"
            labelMargin="20"
            tickLength="1"
            labelFitMode="Multiline"
            plotMode="OnTicks"
          >
          </CategoricalAxis>

          <LinearAxis
            tkCartesianVerticalAxis
            id="vAxis"
            [labelTextColor]="savedTheme == 'DARK' ? 'White' : 'Black'"
            horizontalLocation="Right"
            labelMargin="10"
            lineHidden="true"
            [maximum]="coastDistanceYAxisMax"
            minumum="0.0"
            [majorStep]="coastDistanceYAxisStep"
            [labelFormat]="coastDistanceYAxisMax === 1.0 ? '%.1f' : '%.0f'"
          ></LinearAxis>

          <BarSeries tkCartesianSeries [items]="usageActivity" seriesName="CoastDistanceUsageActivity" categoryProperty="xAxis" valueProperty="coastDistance"> </BarSeries>

          <BarSeries tkCartesianSeries [items]="usageActivity" seriesName="DriveDistanceUsageActivity" categoryProperty="xAxis" valueProperty="driveDistance"> </BarSeries>

          <ChartGridLineAnnotation
            tkCartesianAnnotations
            axisId="vAxis"
            hidden="false"
            [value]="distancePlotAnnotationValue"
            zPosition="AboveSeries"
            strokeWidth="2"
            [strokeColor]="savedTheme === 'DEFAULT' ? '#e31c79' : '#00c1d5'"
            strokeDashPattern="3, 3"
          >
          </ChartGridLineAnnotation>
        </RadCartesianChart>
      </GridLayout>
    </StackLayout>
  </ScrollView>
</PullToRefresh>
