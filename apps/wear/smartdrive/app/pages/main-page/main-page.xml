<Page xmlns="http://schemas.nativescript.org/tns.xsd"
      xmlns:nac="nativescript-animated-circle"
      xmlns:wol="nativescript-wear-os/packages/wear-os-layout"
      xmlns:lv="nativescript-wear-os/packages/listview"
      xmlns:pager="nativescript-pager"
      xmlns:sdl="nativescript-wear-os/packages/swipe-dismiss-layout"
      xmlns:box="nativescript-wear-os/packages/box-inset-layout"
      xmlns:ui="nativescript-auto-fit-text"
      loaded="onMainPageLoaded"
      navigatingTo="navigatingTo"
      marginBottom="{{ chinSize / 2 }}"
      actionBarHidden="true">
  <GridLayout rows="*, *" columns="*">

    <pager:Pager id="pager" loaded="{{ onPagerLoaded }}" orientation="vertical"
                 height="100%" width="100%"
                 col="0" row="0" rowSpan="2"
                 transformer="none" pagesCount="4" showNativePageIndicator="false"
                 disableSwipe="{{ powerAssistActive || isTraining }}"
                 visibility="{{ enabledLayout.main, enabledLayout.main ? 'visible':'collapsed' }}">
      // Activate Power Assist Screen
      <pager:PagerItem>
        <GridLayout rows="32, auto, *" columns="*, auto, *" height="100%" width="100%">
          // Power Assist Circle
          <nac:AnimatedCircle id="powerAssistCircle"
                              rowSpan="3" colSpan="3"
                              class="powerAssistCircle"
                              width="100%" height="100%"
                              animated="true" animateFrom="0"
                              rimColor="{{ powerAssistRingColor }}"
                              barColor="{{ powerAssistRingColor }}"
                              clockwise="true" rimWidth="12" progress="100"
                              visibility="{{ ((powerAssistActive || isTraining) && !hasTapped) ? 'visible':'collapsed' }}">
          </nac:AnimatedCircle>
          // Tap indication circle
          <nac:AnimatedCircle id="tapCircle"
                              rowSpan="3" colSpan="3"
                              class="tapCircle"
                              width="100%" height="100%"
                              rimWidth="12" progress="100"
                              animated="true" animateFrom="0"
                              visibility="{{ hasTapped ? 'visible':'collapsed' }}">
          </nac:AnimatedCircle>
          // SmartDrive Battery Circle
          <nac:AnimatedCircle id="smartDriveBatteryCircle"
                              rowSpan="3" colSpan="3"
                              class="sdBatteryCircle"
                              width="90%" height="90%"
                              animated="true" animateFrom="0" clockwise="true"
                              rimWidth="2" barWidth="8"
                              progress="{{ smartDriveCurrentBatteryPercentage }}">
          </nac:AnimatedCircle>
          // Watch Battery Circle
          <nac:AnimatedCircle id="watchBatteryCircle"
                              rowSpan="3" colSpan="3"
                              class="watchBatteryCircle"
                              width="84%" height="84%"
                              animated="true" animateFrom="0" clockwise="true"
                              rimWidth="2" barWidth="8"
                              progress="{{ watchCurrentBatteryPercentage }}">
          </nac:AnimatedCircle>
          // ambient time display
          <StackLayout id="ambientTimeDisplay"
                       rowSpan="3" colSpan="3"
                       loaded="onAmbientTimeViewLoaded"
                       verticalAlignment="center"
                       width="100%" height="100%"
                       class="circleDetails"
                       visibility="{{ isAmbient, isAmbient ? 'visible':'collapsed' }}">
            <Label class="center-label-base ambient-show fs24 bold" textWrap="true"
                   textAlignment="center"
                   text="{{ currentTime + (currentTimeMeridiem ? (' ' + currentTimeMeridiem) : '') }}"
                   />
            <Label class="center-label-base ambient-show fs16" textWrap="true"
                   textAlignment="center"
                   text="{{ currentDay + ' ' + currentYear }}"/>
          </StackLayout>
          // power assist controls / info display
          <GridLayout id="powerAssistGridLayout"
                      rowSpan="3" colSpan="3"
                      width="90%" height="90%"
                      loaded="onPowerAssistViewLoaded"
                      rows="15, auto, auto, *, auto, auto, 15" columns="30, *, 30"
                      class="circleDetails"
                      visibility="{{ isAmbient, isAmbient ? 'collapsed':'visible'}}">
            <StackLayout row="1" col="1" rowSpan="2"
                         padding="0 0 5 0"
                         tap="{{ toggleDebug }}"
                         visibility="{{ !motorOn ? 'visible':'collapsed' }}">
              <Label class="topValue" horizontalAlignment="center" textWrap="true"
                     text="{{ estimatedDistanceDisplay }}"/>
              <ui:AutoFitText class="topValueDescription"
                     text="{{ estimatedDistanceDescription }}"/>
            </StackLayout>
            <StackLayout row="1" col="1" rowSpan="2"
                         tap="{{ toggleDebug }}"
                         padding="0 0 5 0"
                         visibility="{{ motorOn ? 'visible':'collapsed' }}">
              <Label class="topValue" horizontalAlignment="center" textWrap="true"
                     text="{{ currentSpeedDisplay }}"/>
              <ui:AutoFitText class="topValueDescription"
                     text="{{ currentSpeedDescription }}"/>
            </StackLayout>
            <Button row="3" col="1"
                    class="{{ (disableWearCheck || watchBeingWorn) ? 'powerAssist-deactive':'powerAssist-disabled' }}"
                    height="100%"
                    width="100%"
                    margin="20" padding="0"
                    text="{{ L('power-assist.activate') }}"
                    tap="{{ enablePowerAssist }}"
                    visibility="{{ (!powerAssistActive && !isTraining) ? 'visible':'collapsed' }}"/>
            <Button row="3" col="1" class="powerAssist-active"
                    text="{{ L('power-assist.deactivate') }}"
                    tap="{{ disablePowerAssist }}"
                    height="100%"
                    width="100%"
                    margin="20" padding="0"
                    visibility="{{ (powerAssistActive && !motorOn) ? 'visible':'collapsed' }}"/>
            <Button row="3" col="1" class="powerAssist-active"
                    height="100%"
                    width="100%"
                    margin="20" padding="0"
                    text="{{ L('power-assist.stop') }}"
                    tap="{{ stopSmartDrive }}"
                    visibility="{{ motorOn ? 'visible':'collapsed' }}"/>
            <Button row="3" col="1" class="powerAssist-training"
                    height="100%"
                    width="100%"
                    margin="20" padding="0"
                    text="{{ L('power-assist.exit-training') }}"
                    tap="{{ onExitTrainingModeTap }}"
                    visibility="{{ isTraining ? 'visible':'collapsed' }}" />
            <StackLayout row="4" col="1" rowSpan="2"
                         tap="{{ toggleTimeDisplay }}"
                         visibility="{{ displayTime ? 'visible':'collapsed' }}">
              <Label class="currentTime" text="{{ currentTime }}" textWrap="true"/>
              <Label class="currentTimeMeridiem" text="{{ currentTimeMeridiem }}" textWrap="true"/>
            </StackLayout>
            <StackLayout row="4" col="1" rowSpan="2"
                         tap="{{ toggleTimeDisplay }}"
                         visibility="{{ !displayTime ? 'visible':'collapsed' }}">
              <Label class="currentTime" text="{{ currentDay }}" textWrap="true"/>
              <Label class="currentTimeMeridiem" text="{{ currentYear }}" textWrap="true"/>
            </StackLayout>
          </GridLayout>

          // Battery Icon
          <StackLayout rowSpan="1" col="1" height="16" class="batteryIconStack">
            <Image class="batteryIcon" src="~/assets/images/round_battery_full_white_24.png" stretch="aspectFit" />
          </StackLayout>

        </GridLayout>
      </pager:PagerItem>

      // SmartDrive Battery Usage Chat
      <pager:PagerItem>
        <box:BoxInsetLayout>
          <GridLayout width="100%" height="100%" rows="auto, auto, *" columns="*, auto" tap="{{ debugChartTap }}">
            <ui:AutoFitText height="15" row="0" colSpan="2" text="{{ L('charts.battery.title') }}" class="chart-title" textWrap="true"/>
            <Label text="" row="1" col="0" class="hr-blue" />
            <Label text="{{ batteryChartMaxValue }}" row="1" col="1" class="chart-max-value" padding="0 0 0 5"/>
            // Battery Usage Bar Chart
            <Repeater row="2" colSpan="2" verticalAlignment="bottom" items="{{ batteryChartData }}" loaded="{{ onBatteryChartRepeaterLoaded }}">
              <Repeater.itemsLayout>
                <FlexboxLayout justifyContent="space-between" flexDirection="row" />
              </Repeater.itemsLayout>
              <Repeater.itemTemplate>
                <GridLayout rows="*, auto" columns="auto" class="chart-stack">
                  <Label height="{{ value }}" class="battery-line"/>
                  <Label row="1" text="{{ day }}" class="line-label" />
                </GridLayout>
              </Repeater.itemTemplate>
            </Repeater>
          </GridLayout>
        </box:BoxInsetLayout>
      </pager:PagerItem>

      // SmartDrive Distance Traveled Chart
      <pager:PagerItem>
        <box:BoxInsetLayout>
          <GridLayout width="100%" height="100%" rows="auto, auto, *" columns="*, auto" tap="{{ debugChartTap }}">
            // Chart Title
            <ui:AutoFitText height="15" row="0" colSpan="8" text="{{ L('charts.distance.title') + ' (' + distanceUnits + ')' }}" class="chart-title" textWrap="true" />
            <Label text="" row="1" col="0" class="hr-blue" />
            <Label text="{{ distanceChartMaxValue }}" row="1" col="1" class="chart-max-value" padding="0 0 0 5"/>
            // Distance Traveled Bar Chart
            <Repeater row="2" colSpan="2" items="{{ distanceChartData }}" loaded="{{ onDistanceChartRepeaterLoaded }}">
              <Repeater.itemsLayout>
                <FlexboxLayout justifyContent="space-between" flexDirection="row" />
              </Repeater.itemsLayout>
              <Repeater.itemTemplate>
                <GridLayout rows="*, auto" columns="auto" class="chart-stack">
                  <Label height="{{ value }}" class="distance-line"/>
                  <Label row="1" text="{{ day }}" class="line-label" />
                </GridLayout>
              </Repeater.itemTemplate>
            </Repeater>
          </GridLayout>
        </box:BoxInsetLayout>
      </pager:PagerItem>

      // Menu Items
      <pager:PagerItem>
        <wol:WearOsLayout
            disableInsetConstraint="true"
            loaded="{{ customWOLInsetLoaded }}"
            height="100%" width="100%">
          <StackLayout height="100%">
            <Label text="{{ L('menu.title') }}" class="chart-title" textWrap="true" />
            <Label text="" class="hr-blue" />
            <ScrollView height="100%">
              <GridLayout rows="*, *, *, *, *, *" columns="auto, *">
                // Settings
                <Label row="0" col="0" text="&#xf21b;" class="bullet-list-icon" textWrap="true" />
                <Label row="0" col="1" text="{{ L('menu.settings') }}" class="settings-label" textWrap="true" tap="{{ onSettingsTap }}" />
                // About
                <Label row="1" col="0" text="&#xf21b;" class="bullet-list-icon" textWrap="true" />
                <Label row="1" col="1" text="{{ L('menu.about') }}" class="settings-label" textWrap="true" tap="{{ onAboutTap }}"/>
                // Training
                <Label row="2" col="0" text="&#xf21b;" class="bullet-list-icon" textWrap="true" />
                <Label row="2" col="1" text="{{ L('menu.training') }}" class="settings-label" textWrap="true" tap="{{ onTrainingTap }}" />
                // Updates
                <Label row="3" col="0" text="&#xf21b;" class="bullet-list-icon" textWrap="true" />
                <Label row="3" col="1" text="{{ L('menu.updates') }}" class="settings-label" textWrap="true" tap="{{ onUpdatesTap }}" />
                // Pair SmartDrive
                <Label row="4" col="0" text="&#xf21b;" class="bullet-list-icon" textWrap="true" />
                <Label row="4" col="1" text="{{ L('settings.pair-smartdrive') }}" class="settings-label" textWrap="true" tap="{{ onPairingTap }}" />
                // Connect PushTracker
                <Label row="5" col="0" text="&#xf21b;" class="bullet-list-icon" textWrap="true"  marginBottom="{{ insetPadding }}" />
                <Label row="5" col="1" text="{{ L('settings.connect-pushtracker') }}" class="settings-label" textWrap="true" tap="{{ onConnectPushTrackerTap }}" marginBottom="{{ insetPadding }}" />
              </GridLayout>
            </ScrollView>
          </StackLayout>
        </wol:WearOsLayout>
      </pager:PagerItem>
    </pager:Pager>

  </GridLayout>

</Page>
